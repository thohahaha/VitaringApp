<ion-content class="page-container">
  <div class="content-area">
    <div class="space-y-8">
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Perangkat Vita Ring</h1>
        <p class="text-gray-600">Detail perangkat: <span class="font-semibold text-orange-600">{{ selectedDevice.name }}</span></p>
      </div>

      <!-- Device Name Card -->
      <div class="neu-card-highlighted neu-shadow p-8 bg-gradient-to-r from-orange-50 to-orange-100">
        <div class="flex items-center justify-between">
          <div class="space-y-3">
            <h3 class="text-xl font-bold text-gray-800">Nama Perangkat</h3>
            <div class="text-3xl font-bold text-orange-600">
              {{ healthData?.deviceName || selectedDevice.name }}
            </div>
            <p class="text-gray-600 font-medium">
              ID: {{ healthData?.deviceID || selectedDevice.serial }}
            </p>
            <p class="text-sm text-gray-500">
              Status: {{ currentConnectionStatus ? 'Terhubung' : 'Terputus' }}
            </p>
          </div>
          <div class="w-20 h-20 relative">
            <div class="w-full h-full rounded-full neu-pulse-border flex items-center justify-center bg-white shadow-lg">
              <ion-icon name="hardware-chip" class="w-10 h-10 text-orange-500" 
                       [ngClass]="{'animate-pulse': currentConnectionStatus, 'opacity-30': !currentConnectionStatus}"></ion-icon>
            </div>
          </div>
        </div>
        <!-- Connection Status Overlay -->
        <div *ngIf="!currentConnectionStatus" class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-20 rounded-2xl">
          <div class="text-center">
            <ion-icon name="alert-circle" class="w-8 h-8 text-gray-500 mb-2"></ion-icon>
            <p class="text-sm font-medium text-gray-600">Perangkat Terputus</p>
          </div>
        </div>
      </div>

      <div class="neu-card p-8 bg-white">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Status Perangkat</h3>
        <div class="space-y-4">
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
            <span class="text-gray-600 font-medium">Model Perangkat</span>
            <span class="font-semibold text-gray-800">{{ healthData?.deviceName || selectedDevice.model }}</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
            <span class="text-gray-600 font-medium">Nomor Seri</span>
            <span class="font-semibold text-gray-800">{{ selectedDevice.serial }}</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
            <span class="text-gray-600 font-medium">Versi Firmware</span>
            <span class="font-semibold text-gray-800">{{ selectedDevice.firmware }}</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
            <span class="text-gray-600 font-medium">Baterai</span>
            <div class="flex items-center space-x-3">
              <ion-icon name="battery-half-outline" class="w-5 h-5" [ngClass]="{'text-orange-500': currentBatteryLevel > 20, 'text-red-500': currentBatteryLevel <= 20}"></ion-icon>
              <span class="font-semibold" [ngClass]="{'text-orange-600': currentBatteryLevel > 20, 'text-red-600': currentBatteryLevel <= 20}">
                {{ currentBatteryLevel.toFixed(0) }}% 
                <span class="text-sm">({{ batteryStatusText }})</span>
              </span>
            </div>
          </div>
          <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
            <span class="text-gray-600 font-medium">Koneksi</span>
            <div class="flex items-center space-x-3">
              <ion-icon name="wifi-outline" class="w-5 h-5" [ngClass]="{'text-emerald-500': currentConnectionStatus, 'text-red-500': !currentConnectionStatus}"></ion-icon>
              <span class="font-semibold" [ngClass]="{'text-emerald-600': currentConnectionStatus, 'text-red-600': !currentConnectionStatus}">
                {{ currentConnectionStatus ? 'Terhubung' : 'Terputus' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- WiFi Connection Control -->
      <div class="neu-card p-8 bg-white">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Kontrol Koneksi WiFi</h3>
        <div class="space-y-4">
          <div class="p-4 bg-blue-50 rounded-xl border border-blue-200">
            <div class="flex items-center space-x-3 mb-3">
              <ion-icon name="wifi" class="w-6 h-6 text-blue-500"></ion-icon>
              <span class="font-semibold text-blue-700">Hubungkan ke ESP32</span>
            </div>
            <p class="text-sm text-blue-600 mb-4">
              Klik tombol di bawah untuk membuka pengaturan WiFi dan menghubungkan perangkat Anda ke ESP32 VitaRing.
            </p>
            <button
              (click)="openWiFiSettings()"
              class="w-full neu-button neu-raised p-4 text-center hover:shadow-lg transition-all duration-200 rounded-2xl border-2 border-blue-100 hover:border-blue-300"
            >
              <div class="flex items-center justify-center space-x-3">
                <ion-icon name="settings-outline" class="w-6 h-6 text-blue-500"></ion-icon>
                <span class="text-lg font-semibold text-gray-700">Buka Pengaturan WiFi</span>
              </div>
            </button>
          </div>
          
          <!-- Connection Control Buttons -->
          <div class="grid grid-cols-2 gap-4">
            <button
              (click)="disconnectDevice()"
              [disabled]="!currentConnectionStatus"
              class="neu-button p-4 text-center transition-all duration-200 rounded-2xl border-2"
              [ngClass]="currentConnectionStatus ? 'neu-raised hover:shadow-lg border-red-100 hover:border-red-300' : 'opacity-50 cursor-not-allowed neu-inset border-gray-200'"
            >
              <div class="flex items-center justify-center space-x-3">
                <ion-icon name="wifi-outline" class="w-5 h-5" 
                         [ngClass]="currentConnectionStatus ? 'text-red-500' : 'text-gray-400'"></ion-icon>
                <span class="text-sm font-semibold" 
                      [ngClass]="currentConnectionStatus ? 'text-gray-700' : 'text-gray-400'">
                  Putus Koneksi
                </span>
              </div>
            </button>
            
            <button
              (click)="reconnectDevice()"
              [disabled]="currentConnectionStatus"
              class="neu-button p-4 text-center transition-all duration-200 rounded-2xl border-2"
              [ngClass]="!currentConnectionStatus ? 'neu-raised hover:shadow-lg border-green-100 hover:border-green-300' : 'opacity-50 cursor-not-allowed neu-inset border-gray-200'"
            >
              <div class="flex items-center justify-center space-x-3">
                <ion-icon name="refresh-outline" class="w-5 h-5" 
                         [ngClass]="!currentConnectionStatus ? 'text-green-500' : 'text-gray-400'"></ion-icon>
                <span class="text-sm font-semibold" 
                      [ngClass]="!currentConnectionStatus ? 'text-gray-700' : 'text-gray-400'">
                  Hubungkan Ulang
                </span>
              </div>
            </button>
          </div>
          
          <!-- Connection Status Info -->
          <div class="p-4 rounded-xl" [ngClass]="currentConnectionStatus ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <ion-icon name="information-circle" class="w-5 h-5" 
                         [ngClass]="currentConnectionStatus ? 'text-green-600' : 'text-red-600'"></ion-icon>
                <span class="font-medium" [ngClass]="currentConnectionStatus ? 'text-green-700' : 'text-red-700'">
                  Status ESP32: {{ currentConnectionStatus ? 'Terhubung' : 'Terputus' }}
                </span>
              </div>
              <div class="text-sm" [ngClass]="currentConnectionStatus ? 'text-green-600' : 'text-red-600'">
                {{ currentConnectionStatus ? 'Data real-time aktif' : 'Tidak ada data' }}
              </div>
            </div>
          </div>
          
          <!-- WiFi Instructions -->
          <div class="p-4 bg-gray-50 rounded-xl">
            <h4 class="font-semibold text-gray-700 mb-2">Langkah-langkah Koneksi:</h4>
            <ol class="text-sm text-gray-600 space-y-1">
              <li>1. Pastikan ESP32 VitaRing dalam mode AP (Access Point)</li>
              <li>2. Klik tombol "Buka Pengaturan WiFi" di atas</li>
              <li>3. Cari jaringan WiFi dengan nama "VitaRing_ESP32" atau serupa</li>
              <li>4. Hubungkan ke jaringan tersebut</li>
              <li>5. Kembali ke aplikasi untuk melihat data sensor real-time</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Real-time Sensor Data from Device -->
      <div class="neu-card p-8 bg-white" *ngIf="healthData && currentConnectionStatus">
        <h3 class="text-xl font-bold text-gray-800 mb-6">Data Sensor Real-time</h3>
        <div class="grid grid-cols-2 gap-4">
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-red-50 to-pink-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="heart" class="w-5 h-5 text-red-500"></ion-icon>
              <span class="text-gray-600 font-medium">BPX</span>
            </div>
            <span class="font-semibold text-red-600">{{ healthData.bpx.toFixed(0) }} BPM</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="thermometer" class="w-5 h-5 text-blue-500"></ion-icon>
              <span class="text-gray-600 font-medium">Suhu BMP</span>
            </div>
            <span class="font-semibold text-blue-600">{{ healthData.bmpTemp.toFixed(1) }}°C</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="sunny" class="w-5 h-5 text-green-500"></ion-icon>
              <span class="text-gray-600 font-medium">Suhu Objek</span>
            </div>
            <span class="font-semibold text-green-600">{{ healthData.objTemp.toFixed(1) }}°C</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="fitness" class="w-5 h-5 text-purple-500"></ion-icon>
              <span class="text-gray-600 font-medium">Tekanan</span>
            </div>
            <span class="font-semibold text-purple-600">{{ healthData.pressure.toFixed(1) }} hPa</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="walk" class="w-5 h-5 text-orange-500"></ion-icon>
              <span class="text-gray-600 font-medium">Ketinggian</span>
            </div>
            <span class="font-semibold text-orange-600">{{ healthData.altitude.toFixed(1) }} m</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-teal-50 to-cyan-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="thermometer-outline" class="w-5 h-5 text-teal-500"></ion-icon>
              <span class="text-gray-600 font-medium">Suhu Ambient</span>
            </div>
            <span class="font-semibold text-teal-600">{{ healthData.ambTemp.toFixed(1) }}°C</span>
          </div>
          <div class="flex justify-between items-center p-4 bg-gradient-to-r from-gray-50 to-slate-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <ion-icon name="moon" class="w-5 h-5 text-gray-500"></ion-icon>
              <span class="text-gray-600 font-medium">IR Value</span>
            </div>
            <span class="font-semibold text-gray-600">{{ healthData.irValue.toFixed(0) }}</span>
          </div>
        </div>
        
        <!-- Additional Device Information -->
        <div class="mt-6 grid grid-cols-2 gap-4">
          <div class="p-4 bg-indigo-50 rounded-xl">
            <div class="flex items-center justify-between">
              <span class="text-indigo-700 font-medium">Device Name</span>
              <span class="text-indigo-600 text-sm font-semibold">{{ healthData.deviceName }}</span>
            </div>
          </div>
          <div class="p-4 bg-green-50 rounded-xl">
            <div class="flex items-center justify-between">
              <span class="text-green-700 font-medium">Data Type</span>
              <span class="text-green-600 text-sm font-semibold">{{ healthData.type }}</span>
            </div>
          </div>
        </div>
        
        <div class="mt-4 p-4 bg-blue-50 rounded-xl">
          <div class="flex items-center justify-between">
            <span class="text-blue-700 font-medium">Terakhir Update</span>
            <span class="text-blue-600 text-sm">{{ healthData.timestamp | date:'dd/MM/yyyy HH:mm:ss' }}</span>
          </div>
        </div>
      </div>

    </div>
  </div>
</ion-content>

<!-- Navbar Component -->
<app-navbar [activeTab]="'perangkat'"></app-navbar>
